/**
 * Create an audio version of your posts, with a selection of more than 235+ voices across more than 40 languages and variants.
 * Exclusively on Envato Market: https://1.envato.market/speaker
 *
 * @encoding        UTF-8
 * @version         3.1.0
 * @copyright       Copyright (C) 2018 - 2020 Merkulove ( https://merkulov.design/ ). All rights reserved.
 * @license         Envato License https://1.envato.market/KYbje
 * @contributors    Alexander Khmelnitskiy (info@alexander.khmelnitskiy.ua), Dmitry Merkulov (dmitry@merkulov.design)
 * @support         help@merkulov.design
 **/
!function(e){"use strict";e(document).ready((function(){let t=window.mdpSpeaker;e(".mdc-list .mdc-list-item.mdp-plugin-title").on("click",(function(){let t=e(this).data("count");void 0===t&&(t=0,setTimeout((function(){e(".mdc-list .mdc-list-item.mdp-plugin-title").removeData("count")}),2e3)),t++,e(this).data("count",t),t>3&&(e(".mdc-list > .mdc-list-item.mdp-developer").removeClass("mdc-hidden").addClass("mdc-list-item--activated"),e(".mdc-list .mdc-list-item.mdp-plugin-title").removeData("count"))})),e("#mdp-dev-reset-settings-btn").on("click",(function(a){a.preventDefault(),e(this).attr("disabled",!0).addClass("mdp-spin").find(".material-icons").text("refresh");let s={action:"reset_settings",nonce:t.nonceResetSettings,doReset:!0};e.post(t.ajaxURL,s,(function(e){console.info("Settings Successfully Cleared.")}),"json").fail((function(e){console.error(e),alert("Looks like an Error has occurred. Please try again later.")})).always((function(){e("#mdp-dev-reset-settings-btn").attr("disabled",!1).removeClass("mdp-spin").find(".material-icons").text("clear_all")}))})),function(){let t=e("#mdp_custom_css_fld");if(!t.length)return;let a,s=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{};s.codemirror=_.extend({},s.codemirror,{indentUnit:2,tabSize:2,mode:"css"}),a=wp.codeEditor.initialize("mdp_custom_css_fld",s),a.codemirror.on("change",(function(e){a.codemirror.save(),t.change()}))}();let a=e("#mdp-speaker-post-types-settings-cpt-support");function s(){let t=a.val();e("#mdp-custom-posts-tbl tr.mdc-data-table__row").hide(300),e.each(t,(function(t,a){e('#mdp-custom-posts-tbl [data-post-type="'+a+'"]').parent().parent().show(300)}))}function n(a){a.preventDefault();let s=e(this);if(s.data("in-progress"))return;s.data("in-progress",!0);let n=s.find("input").val(),o=s.parent().prev().find("span[data-post-type]").data("post-type"),i={action:"set_default_st",nonce:t.nonce,stid:n,postType:o};e.post(t.ajaxURL,i,(function(e){e.success?console.info("Default template for "+o+" was changed successfully."):g(e)})).fail((function(e){g(e)})).always((function(){s.removeData("in-progress")}))}a.chosen({width:"100%",search_contains:!0,disable_search_threshold:7,inherit_select_classes:!0,no_results_text:"Oops, nothing found"}),e(document).on("change",a,s),s(),e("#mdp-custom-posts-tbl .mdc-select[data-mdc-index]").each((function(){let t,a=e(this).data("mdc-index");t=window.MerkulovMaterial[a],t.listen("MDCSelect:change",n)}));let o=e("#mdp-speaker-settings-language-tbl");o.removeClass("hidden"),o.DataTable({lengthMenu:[[-1],["All"]],initComplete:function(){this.api().columns().every((function(){let t=this,a=e("#mdp-speaker-language-filter");0===t[0][0]&&a.on("change",(function(){e("#mdp-speaker-settings-language-tbl tbody").show(),e("#mdp-speaker-settings-language-tbl_info").show(),e("#mdp-speaker-settings-language-tbl_paginate").hide(),e("#mdp-speaker-settings-language-tbl_length").hide(),e("#mdp-speaker-settings-language-tbl thead").show();let a=e.fn.dataTable.util.escapeRegex(e(this).val());"0"===a&&(a=""),t.search(a?"^"+a+"$":"",!0,!1).draw()}))})),e("#mdp-speaker-settings-language-tbl tbody").hide(),e("#mdp-speaker-settings-language-tbl_info").hide(),e("#mdp-speaker-settings-language-tbl_paginate").hide(),e("#mdp-speaker-settings-language-tbl_length").hide(),e("#mdp-speaker-settings-language-tbl thead").hide()}}),e("#mdp-speaker-settings-language-tbl tbody").on("click","tr",(function(){e("#mdp-speaker-settings-language-tbl tr.selected").removeClass("selected"),e(this).addClass("selected");let t=e("#mdp-speaker-settings-language-tbl tr.selected .mdp-lang-code").text(),a=e("#mdp-speaker-settings-language-tbl tr.selected .mdp-voice-name").attr("title");e(".mdp-now-used strong").html(a),e("#mdp-speaker-settings-language-code").val(t),e("#mdp-speaker-settings-language").val(a);let s=e(".mdp-now-used audio");e(".mdp-now-used audio source:nth-child(1)").attr("src","https://cloud.google.com/text-to-speech/docs/audio/"+a+".mp3"),e(".mdp-now-used audio source:nth-child(2)").attr("src","https://cloud.google.com/text-to-speech/docs/audio/"+a+".wav"),s[0].pause(),s[0].load()}));let i=e("#mdp-speaker-language-filter").parent().data("mdc-index");o.DataTable().rows().every((function(t,a,s){let n=this.data();n[1].includes(e("#mdp-speaker-settings-language").val())&&(window.MerkulovMaterial[i].value=n[0])}));let l=e("#mdp-api-key-drop-zone");l.on("dragenter",(function(){u(),e(this).addClass("mdp-hover")})),l.on("dragleave",(function(){e(this).removeClass("mdp-hover")})),l.on("dragover",(function(e){e.stopPropagation(),e.preventDefault()}));let r=e("#mdp-speaker-settings-dnd-api-key");function d(t){let a=new FileReader;a.onload=function(t){let a=t.target.result;return function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(a)?void 0===JSON.parse(a).private_key?(p("Error: Your API key file looks like not valid. Please make sure you use the correct key."),void l.removeClass("mdp-busy")):(r.val(btoa(a)),u(),void(r.val().length>1e3?e("#submit").click():(p("Error: Your API key file looks like not valid. Please make sure you use the correct key."),l.removeClass("mdp-busy")))):(p("Error: Uploaded file is empty or not a valid JSON file."),void l.removeClass("mdp-busy"))},a.readAsText(t)}l.on("drop",(function(t){t.stopPropagation(),t.preventDefault(),e(this).removeClass("mdp-hover"),l.addClass("mdp-busy");let a=t.originalEvent.dataTransfer.files[0];m(a)?d(a):l.removeClass("mdp-busy")}));let c=e("#mdp-dnd-file-input");function p(e){l.next().addClass("mdp-error").html(e)}function u(){l.next().removeClass("mdp-error").html("")}function m(e){return null==e?(p("Error: Failed to read file. Please try again."),!1):!!e.type.match("application/json")||(p("Error: API Key must be a valid JSON file."),!1)}function g(e){console.error(e),e.message?window.alert("ERROR:\n "+e.message):e.responseText?window.alert("ERROR:\n "+e.responseText):window.alert("ERROR:\n "+e)}l.on("click",(function(){c.click()})),c.on("change",(function(e){l.addClass("mdp-busy");let t=e.target.files[0];m(t)?d(t):l.removeClass("mdp-busy")})),e(".mdp-reset-key-btn").on("click",(function(){r.val(""),e("#submit").trigger("click")})),e("#mdp-speaker-subscribe").on("click",(function(t){t.preventDefault();let a=e("#mdp-speaker-subscribe-mail").val(),s=e("#mdp-speaker-subscribe-name").val(),n=e("#mdp-speaker-subscribe-mail").parent().data("mdc-index");a.length>0&&window.MerkulovMaterial[n].valid?(e("#mdp-speaker-subscribe-name").prop("disabled",!0),e("#mdp-speaker-subscribe-mail").prop("disabled",!0),e("#mdp-speaker-subscribe").prop("disabled",!0),e.ajax({type:"GET",url:"https://merkulove.host/wp-content/plugins/mdp-purchase-validator/esputnik/subscribe.php",crossDomain:!0,data:"name="+s+"&mail="+a+"&plugin=speaker",success:function(e){!0===e&&alert("We received your Subscription request. Now you need to confirm your subscription. Please check your inbox for an email from us.")},error:function(e){alert(e)}})):window.MerkulovMaterial[n].valid=!1}));let f=e("#mdp_speaker_updates_settings-btn");f.on("click",(function(a){a.preventDefault(),f.attr("disabled",!0).addClass("mdp-spin").find(".material-icons").text("refresh");let s={action:"check_updates",nonce:t.nonce,checkUpdates:!0};e.post(t.ajaxURL,s,(function(e){e?(console.info("Latest version information updated."),location.reload()):console.warn(e)}),"json").fail((function(e){console.error(e),alert("Looks like an Error has occurred. Please try again later.")})).always((function(){f.attr("disabled",!1).removeClass("mdp-spin").find(".material-icons").text("autorenew")}))}))}))}(jQuery);